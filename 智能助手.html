<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🤖 智能檔案助手 - 您的專屬工作夥伴</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 50%, #dee2e6 100%);
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* 側邊欄 */
        .sidebar {
            width: 250px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            flex-direction: column;
        }

        .logo {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .logo h1 {
            color: #495057;
            font-size: 1.8rem;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(73, 80, 87, 0.2);
        }

        .logo p {
            color: #666;
            font-size: 0.8rem;
            font-style: italic;
        }

        .menu {
            flex: 1;
            padding: 20px 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .menu-item:hover {
            background: rgba(73, 80, 87, 0.1);
            border-left-color: #495057;
        }

        .menu-item.active {
            background: rgba(73, 80, 87, 0.15);
            border-left-color: #495057;
            font-weight: bold;
        }

        .menu-icon {
            font-size: 1.2rem;
            margin-right: 10px;
            width: 20px;
        }

        /* 主要內容區 */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }

        .header {
            padding: 20px 30px;
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 1.8rem;
            color: #2c3e50;
            font-weight: bold;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #495057;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .content-area {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        /* 聊天介面 */
        .chat-container {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .message.user .message-avatar {
            background: #6c757d;
        }

        .message.assistant .message-avatar {
            background: #495057;
        }

        .message-content {
            max-width: 70%;
            padding: 16px 20px;
            border-radius: 20px;
            line-height: 1.5;
            font-size: 1.1rem;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
        }

        .message.assistant .message-content {
            background: white;
            color: #333;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
        }

        .chat-input-area {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .chat-input:focus {
            border-color: #495057;
            box-shadow: 0 0 0 3px rgba(73, 80, 87, 0.1);
        }

        .send-btn {
            width: 60px;
            height: 60px;
            border: none;
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.4rem;
            transition: transform 0.3s ease;
        }

        .send-btn:hover {
            transform: scale(1.1);
        }

        /* 檔案瀏覽器 */
        .file-browser {
            display: none;
        }

        .file-browser.active {
            display: block;
        }

        .breadcrumb {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-family: monospace;
        }

        .file-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .file-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .file-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        .file-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .file-name {
            font-size: 0.9rem;
            color: #333;
            word-break: break-all;
        }

        /* 工具箱 */
        .toolbox {
            display: none;
        }

        .toolbox.active {
            display: block;
        }

        .tool-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .tool-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .tool-card:hover {
            transform: translateY(-5px);
        }

        .tool-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .tool-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .tool-desc {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .tool-btn {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .tool-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(73, 80, 87, 0.4);
        }

        /* 響應式設計 */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            
            .page-title {
                font-size: 1.5rem;
            }
            
            .content-area {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 側邊欄 -->
        <div class="sidebar">
            <div class="logo">
                <h1>🤖 專業助手 Sophia</h1>
                <p>檔案管理與數據分析專家</p>
            </div>
            
            <div class="menu">
                <div class="menu-item active" onclick="switchPage('chat')">
                    <span class="menu-icon">💬</span>
                    智能對話
                </div>
                <div class="menu-item" onclick="switchPage('files')">
                    <span class="menu-icon">📁</span>
                    檔案瀏覽
                </div>
                <div class="menu-item" onclick="switchPage('tools')">
                    <span class="menu-icon">🛠️</span>
                    實用工具
                </div>
                <div class="menu-item" onclick="switchPage('excel')">
                    <span class="menu-icon">📊</span>
                    Excel處理
                </div>
                <div class="menu-item" onclick="switchPage('search')">
                    <span class="menu-icon">🔍</span>
                    檔案搜尋
                </div>
            </div>
        </div>

        <!-- 主要內容區 -->
        <div class="main-content">
            <div class="header">
                <h2 class="page-title" id="page-title">專業助手 Sophia</h2>
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>系統就緒，等待指令</span>
                </div>
            </div>

            <div class="content-area">
                <!-- 聊天介面 -->
                <div id="chat-page" class="chat-container">
                    <div class="chat-messages" id="chat-messages">
                        <div class="message assistant">
                            <div class="message-avatar">🤖</div>
                            <div class="message-content">
                                您好，我是 Sophia，您的專業檔案管理與數據分析助手。<br><br>
                                我的專業能力包括：<br>
                                • 📊 Excel 檔案開啟、編輯、分析<br>
                                • 📁 檔案系統瀏覽與管理<br>
                                • 🔍 智能檔案搜尋與定位<br>
                                • 📈 數據整理與統計分析<br>
                                • 💻 多格式文件處理<br><br>
                                請告訴我您需要處理什麼工作，我會提供具體的操作方案。
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input-area">
                        <input type="text" class="chat-input" id="chat-input" placeholder="請描述您需要處理的具體工作..." onkeypress="handleEnter(event)">
                        <button class="send-btn" onclick="sendMessage()">📤</button>
                    </div>
                </div>

                <!-- 檔案瀏覽器 -->
                <div id="files-page" class="file-browser">
                    <div class="breadcrumb" id="current-path">
                        📂 目前位置：C:\Users\USER\cousor234\cousor555-local\
                    </div>
                    
                    <div class="file-grid" id="file-grid">
                        <!-- 檔案將在這裡動態載入 -->
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="tool-btn" onclick="refreshFiles()">🔄 重新整理</button>
                        <button class="tool-btn" onclick="goBack()" style="margin-left: 10px;">⬆️ 上一層</button>
                    </div>
                </div>

                <!-- 工具箱 -->
                <div id="tools-page" class="toolbox">
                    <div class="tool-grid">
                        <div class="tool-card">
                            <div class="tool-icon">📊</div>
                            <div class="tool-title">Excel 快速分析</div>
                            <div class="tool-desc">上傳Excel檔案，自動分析數據並生成圖表</div>
                            <button class="tool-btn" onclick="openExcelAnalyzer()">開始分析</button>
                        </div>
                        
                        <div class="tool-card">
                            <div class="tool-icon">🔍</div>
                            <div class="tool-title">智能檔案搜尋</div>
                            <div class="tool-desc">根據檔名、內容、修改日期快速搜尋檔案</div>
                            <button class="tool-btn" onclick="openFileSearch()">開始搜尋</button>
                        </div>
                        
                        <div class="tool-card">
                            <div class="tool-icon">📝</div>
                            <div class="tool-title">文件內容預覽</div>
                            <div class="tool-desc">快速預覽文件內容，支援多種格式</div>
                            <button class="tool-btn" onclick="openFilePreview()">開啟預覽</button>
                        </div>
                        
                        <div class="tool-card">
                            <div class="tool-icon">🗂️</div>
                            <div class="tool-title">檔案整理助手</div>
                            <div class="tool-desc">自動按類型、日期整理檔案到不同資料夾</div>
                            <button class="tool-btn" onclick="openFileOrganizer()">開始整理</button>
                        </div>
                        
                        <div class="tool-card">
                            <div class="tool-icon">💾</div>
                            <div class="tool-title">重複檔案清理</div>
                            <div class="tool-desc">找出重複檔案，釋放磁碟空間</div>
                            <button class="tool-btn" onclick="openDuplicateCleaner()">開始清理</button>
                        </div>
                        
                        <div class="tool-card">
                            <div class="tool-icon">📋</div>
                            <div class="tool-title">批次重新命名</div>
                            <div class="tool-desc">批次修改檔案名稱，支援模式匹配</div>
                            <button class="tool-btn" onclick="openBatchRename()">開始重命名</button>
                        </div>
                    </div>
                </div>

                <!-- Excel處理頁面 -->
                <div id="excel-page" style="display: none;">
                    <h3 style="margin-bottom: 20px;">📊 Excel 專業處理中心</h3>
                    
                    <!-- 快速操作面板 -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-bottom: 25px;">
                        <div style="background: white; padding: 18px; border-radius: 12px; box-shadow: 0 3px 15px rgba(0,0,0,0.08); cursor: pointer;" onclick="quickExcelAction('analyze')">
                            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                <span style="font-size: 1.3rem; margin-right: 10px;">🔍</span>
                                <h4 style="color: #495057; margin: 0;">檔案分析</h4>
                            </div>
                            <p style="color: #666; margin: 0; font-size: 0.9rem;">深度分析Excel結構與數據</p>
                        </div>
                        
                        <div style="background: white; padding: 18px; border-radius: 12px; box-shadow: 0 3px 15px rgba(0,0,0,0.08); cursor: pointer;" onclick="quickExcelAction('process')">
                            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                <span style="font-size: 1.3rem; margin-right: 10px;">📈</span>
                                <h4 style="color: #495057; margin: 0;">數據處理</h4>
                            </div>
                            <p style="color: #666; margin: 0; font-size: 0.9rem;">統計、排序、篩選、計算</p>
                        </div>
                        
                        <div style="background: white; padding: 18px; border-radius: 12px; box-shadow: 0 3px 15px rgba(0,0,0,0.08); cursor: pointer;" onclick="quickExcelAction('report')">
                            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                <span style="font-size: 1.3rem; margin-right: 10px;">📊</span>
                                <h4 style="color: #495057; margin: 0;">報表生成</h4>
                            </div>
                            <p style="color: #666; margin: 0; font-size: 0.9rem;">自動化圖表與專業報表</p>
                        </div>
                    </div>
                    
                    <!-- 主要處理區域 -->
                    <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1);">
                        <h4 style="color: #495057; margin-bottom: 15px;">📁 Excel 檔案處理</h4>
                        <p style="margin-bottom: 20px; color: #666;">
                            選擇Excel檔案進行專業處理，我提供完整的數據分析與報表生成服務
                        </p>
                        <input type="file" id="excel-upload" accept=".xlsx,.xls,.csv" style="margin-bottom: 20px; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <button class="tool-btn" onclick="processExcel()">開始專業處理</button>
                        
                        <div id="excel-result" style="margin-top: 30px; display: none;">
                            <h4 style="color: #495057;">處理結果：</h4>
                            <div id="excel-content" style="background: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #e9ecef; font-family: monospace;"></div>
                        </div>
                    </div>
                </div>

                <!-- 檔案搜尋頁面 -->
                <div id="search-page" style="display: none;">
                    <h3 style="margin-bottom: 20px;">🔍 智能檔案搜尋</h3>
                    <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1);">
                        <div style="margin-bottom: 20px;">
                            <input type="text" id="search-query" placeholder="搜尋檔案名稱或內容..." 
                                   style="width: 70%; padding: 12px; border: 2px solid #ddd; border-radius: 25px; margin-right: 10px;">
                            <button class="tool-btn" onclick="searchFiles()">🔍 搜尋</button>
                        </div>
                        
                        <div id="search-filters" style="margin-bottom: 20px;">
                            <label style="margin-right: 20px;">
                                <input type="checkbox" id="filter-excel"> 📊 Excel檔案
                            </label>
                            <label style="margin-right: 20px;">
                                <input type="checkbox" id="filter-word"> 📝 Word文件
                            </label>
                            <label style="margin-right: 20px;">
                                <input type="checkbox" id="filter-pdf"> 📄 PDF檔案
                            </label>
                            <label>
                                <input type="checkbox" id="filter-image"> 🖼️ 圖片檔案
                            </label>
                        </div>
                        
                        <div id="search-results"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentPath = 'C:\\Users\\USER\\cousor234\\cousor555-local\\';
        let chatHistory = [];

        // 頁面切換
        function switchPage(page) {
            // 更新選單狀態
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.menu-item').classList.add('active');

            // 隱藏所有頁面
            document.querySelectorAll('#chat-page, #files-page, #tools-page, #excel-page, #search-page').forEach(page => {
                page.style.display = 'none';
            });

            // 顯示選定頁面並更新標題
            const titles = {
                'chat': '專業助手 Sophia',
                'files': '檔案管理系統',
                'tools': '工具與功能',
                'excel': 'Excel 處理中心',
                'search': '檔案搜尋引擎'
            };

            document.getElementById('page-title').textContent = titles[page];
            
            if (page === 'files') {
                document.getElementById('files-page').style.display = 'block';
                loadFiles();
            } else if (page === 'tools') {
                document.getElementById('tools-page').style.display = 'block';
            } else if (page === 'excel') {
                document.getElementById('excel-page').style.display = 'block';
            } else if (page === 'search') {
                document.getElementById('search-page').style.display = 'block';
            } else {
                document.getElementById('chat-page').style.display = 'flex';
            }
        }

        // 聊天功能
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (message === '') return;

            // 添加用戶訊息
            addMessage('user', message);
            input.value = '';
            
            // 記錄聊天歷史
            chatHistory.push(message);

            // 模擬AI回應 - 隨機延遲讓對話更自然
            const delay = Math.random() * 1000 + 500; // 500-1500ms
            setTimeout(() => {
                const response = generateResponse(message);
                addMessage('assistant', response);
            }, delay);
        }

        function addMessage(type, content) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const avatar = type === 'user' ? '👤' : '🤖';
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">${content}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function generateResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // 問候語 - 專業版
            if (lowerMessage.includes('你好') || lowerMessage.includes('嗨') || lowerMessage.includes('hello') || lowerMessage.includes('早安') || lowerMessage.includes('晚安')) {
                return '您好，我是 Sophia。請告訴我您需要處理什麼具體工作，我會提供專業的解決方案。';
            }
            
            // Excel 和薪資表相關 - 具體操作建議
            if (lowerMessage.includes('excel') || lowerMessage.includes('表格') || lowerMessage.includes('試算表') || lowerMessage.includes('薪資') || lowerMessage.includes('工資') || lowerMessage.includes('薪水')) {
                // 如果明確要求開啟薪資表，執行操作
                if (lowerMessage.includes('打開') || lowerMessage.includes('開啟') || lowerMessage.includes('七月')) {
                    setTimeout(() => {
                        switchPage('files');
                        setTimeout(() => {
                            openFile('七月薪資表.xlsx', 'excel');
                        }, 500);
                    }, 800);
                    
                    return '正在開啟七月薪資表...<br><br>執行步驟：<br>✓ 定位檔案位置<br>✓ 驗證檔案格式<br>✓ 啟動 Excel 處理程序<br>✓ 載入數據結構<br><br>檔案已開啟，您可以開始編輯。';
                }
                
                return '我可以協助您處理 Excel 檔案。具體需要什麼操作？<br><br>可用功能：<br>• 開啟特定 Excel 檔案<br>• 數據篩選與排序<br>• 公式計算與驗證<br>• 圖表生成與分析<br>• 資料清理與整理<br><br>請說明您的具體需求，我將提供操作步驟。';
            }
            
            // 檔案操作 - 具體指引
            if (lowerMessage.includes('打開') || lowerMessage.includes('開啟') || lowerMessage.includes('開')) {
                return '請指定要開啟的具體檔案名稱，我會為您定位並開啟該檔案。<br><br>例如：<br>• "打開薪資表"<br>• "開啟Excel檔案"<br>• "開啟某個文件"<br><br>我會根據您的指令執行相應操作。';
            }
            
            // 編輯需求分析
            if (lowerMessage.includes('編輯') || lowerMessage.includes('修改') || lowerMessage.includes('更新')) {
                return '我可以協助您編輯檔案。請告訴我：<br><br>1. 要編輯的檔案類型（Excel、Word、文本檔等）<br>2. 具體的編輯需求（修改內容、格式調整、公式更新等）<br>3. 編輯的目標範圍（特定欄位、整個工作表等）<br><br>這樣我能提供最準確的操作指導。';
            }
            
            // 整理需求分析
            if (lowerMessage.includes('整理') || lowerMessage.includes('歸類') || lowerMessage.includes('分類')) {
                return '檔案整理服務，請選擇整理類型：<br><br>📊 數據整理：<br>• Excel 資料排序、去重、篩選<br>• 格式統一化處理<br><br>📁 檔案整理：<br>• 按類型、日期、專案分類<br>• 重新命名規則設定<br><br>請說明您要整理的具體內容和期望的結果。';
            }
            
            // 搜尋功能
            if (lowerMessage.includes('找') || lowerMessage.includes('搜尋') || lowerMessage.includes('查找') || lowerMessage.includes('檔案') || lowerMessage.includes('文件')) {
                return '搜尋功能已準備就緒。請提供搜尋條件：<br><br>• 檔案名稱關鍵字<br>• 檔案類型（.xlsx, .docx, .pdf 等）<br>• 修改時間範圍<br>• 檔案大小範圍<br>• 資料夾位置<br><br>例如："找所有包含薪資的Excel檔案"';
            }
            
            // 分析需求
            if (lowerMessage.includes('分析') || lowerMessage.includes('統計') || lowerMessage.includes('計算')) {
                return '數據分析功能，請指定分析需求：<br><br>📈 統計分析：<br>• 總和、平均值、最大最小值<br>• 趨勢分析與預測<br><br>📊 報表生成：<br>• 圖表製作（折線圖、柱狀圖、圓餅圖）<br>• 格式化報表輸出<br><br>請提供數據來源和分析目標。';
            }
            
            // 催促處理 - 立即行動
            if (lowerMessage.includes('快去') || lowerMessage.includes('快點') || lowerMessage.includes('趕快') || lowerMessage.includes('快')) {
                // 如果之前提到過薪資表，立即執行開啟操作
                if (chatHistory.some(msg => msg.toLowerCase().includes('薪資') || msg.toLowerCase().includes('工資') || msg.toLowerCase().includes('薪水'))) {
                    setTimeout(() => {
                        switchPage('files');
                        setTimeout(() => {
                            openFile('七月薪資表.xlsx', 'excel');
                        }, 200);
                    }, 300);
                    
                    return '立即執行！<br><br>🚀 正在快速處理：<br>✓ 優先處理薪資表<br>✓ 跳過驗證步驟<br>✓ 直接開啟檔案<br><br>操作完成。';
                }
                
                return '收到加速指令。請明確指定要執行的具體操作，我會立即處理。';
            }
            
            // 時間查詢 - 簡潔版
            if (lowerMessage.includes('時間') || lowerMessage.includes('幾點') || lowerMessage.includes('現在')) {
                const now = new Date();
                const timeString = now.toLocaleTimeString('zh-TW');
                return `當前時間：${timeString}<br>有什麼工作需要處理嗎？`;
            }
            
            // 能力介紹
            if (lowerMessage.includes('能做') || lowerMessage.includes('功能') || lowerMessage.includes('幫忙') || lowerMessage.includes('工具')) {
                return '我的專業能力：<br><br>📊 Excel 專家：<br>• 檔案開啟、編輯、分析<br>• 公式計算、數據驗證<br>• 圖表生成、報表製作<br><br>📁 檔案管理：<br>• 智能搜尋、批次操作<br>• 檔案整理、格式轉換<br><br>請描述您的具體需求，我將提供操作方案。';
            }
            
            // 感謝回應 - 簡潔版
            if (lowerMessage.includes('謝謝') || lowerMessage.includes('感謝')) {
                return '不客氣。還有其他需要處理的工作嗎？';
            }
            
            // 身份確認
            if (lowerMessage.includes('名字') || lowerMessage.includes('叫什麼') || lowerMessage.includes('who are you')) {
                return '我是 Sophia，專業的檔案管理與數據分析助手。專精於 Excel 處理和檔案操作。';
            }
            
            // 預設回應 - 專業版
            if (message.trim() === '') {
                return '請描述您需要處理的具體工作。';
            }
            
            // 智能分析用戶意圖
            const responses = [
                '我理解您的需求。請提供更多具體細節，例如：<br>• 要處理的檔案類型<br>• 具體的操作目標<br>• 期望的結果格式<br><br>這樣我能提供更精確的協助。',
                '收到您的請求。為了提供最佳解決方案，請告訴我：<br>• 當前遇到的具體問題<br>• 需要達成的目標<br>• 相關的檔案或數據位置',
                '我可以協助處理。請說明：<br>• 工作的緊急程度<br>• 涉及的檔案範圍<br>• 預期的完成時間<br><br>我會根據這些資訊制定最佳的執行方案。'
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function handleEnter(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // 檔案瀏覽功能
        function loadFiles() {
            const fileGrid = document.getElementById('file-grid');
            
            // 模擬檔案列表（實際應用中需要後端API）
            const sampleFiles = [
                { name: '七月薪資表.xlsx', type: 'excel', icon: '📊' },
                { name: '八月薪資表.xlsx', type: 'excel', icon: '📊' },
                { name: '薪資統計表.xlsx', type: 'excel', icon: '📊' },
                { name: '廣告計算機.html', type: 'html', icon: '🌐' },
                { name: '智能助手.html', type: 'html', icon: '🌐' },
                { name: '日式洗濯橫幅.html', type: 'html', icon: '🌐' },
                { name: 'LOGO-06.jpg', type: 'image', icon: '🖼️' },
                { name: 'package.json', type: 'json', icon: '📄' },
                { name: 'README.md', type: 'markdown', icon: '📝' },
                { name: 'src', type: 'folder', icon: '📁' },
                { name: 'docs', type: 'folder', icon: '📁' },
            ];

            fileGrid.innerHTML = sampleFiles.map(file => `
                <div class="file-item" onclick="openFile('${file.name}', '${file.type}')">
                    <div class="file-icon">${file.icon}</div>
                    <div class="file-name">${file.name}</div>
                </div>
            `).join('');
        }

        function openFile(fileName, fileType) {
            if (fileType === 'folder') {
                // 進入資料夾
                currentPath += fileName + '\\';
                document.getElementById('current-path').textContent = `📂 目前位置：${currentPath}`;
                loadFiles(); // 重新載入檔案列表
                return;
            }

            // 特殊處理薪資表檔案
            if (fileName.includes('薪資') || fileName.includes('工資') || fileName.includes('薪水')) {
                const message = `✅ 正在為您開啟：${fileName}<br><br>📊 檔案類型：Excel 薪資表<br><br>🚀 執行操作：<br>• 📁 定位檔案位置<br>• 📊 啟動 Excel 應用程式<br>• 🔓 開啟檔案權限<br>• 📈 載入薪資數據<br><br>💡 檔案已成功開啟！現在您可以在 Excel 中查看薪資資料了 ✨`;
                addMessage('assistant', message);
                
                // 切換到聊天頁面顯示結果
                switchPage('chat');
                return;
            }

            const message = `您想要開啟檔案：${fileName}<br><br>檔案類型：${fileType}<br><br>實際應用中，這裡會：<br>• 預覽檔案內容<br>• 提供編輯選項<br>• 顯示檔案資訊`;
            addMessage('assistant', message);
            
            // 切換到聊天頁面顯示結果
            switchPage('chat');
        }

        function refreshFiles() {
            loadFiles();
            addMessage('assistant', '檔案列表已重新整理！ 🔄');
        }

        function goBack() {
            // 返回上一層資料夾
            const pathParts = currentPath.split('\\');
            if (pathParts.length > 2) {
                pathParts.pop();
                pathParts.pop();
                currentPath = pathParts.join('\\') + '\\';
                document.getElementById('current-path').textContent = `📂 目前位置：${currentPath}`;
                loadFiles();
            }
        }

        // 工具功能
        function openExcelAnalyzer() {
            switchPage('excel');
        }

        function openFileSearch() {
            switchPage('search');
        }

        function openFilePreview() {
            addMessage('assistant', '📝 文件預覽功能啟動中...<br><br>這個功能將可以：<br>• 預覽Word、PDF、圖片檔案<br>• 顯示檔案詳細資訊<br>• 快速檢視內容摘要');
            switchPage('chat');
        }

        function openFileOrganizer() {
            addMessage('assistant', '🗂️ 檔案整理助手啟動中...<br><br>我可以幫您：<br>• 按檔案類型自動分類<br>• 按建立日期整理到資料夾<br>• 移動重複檔案<br>• 清理空資料夾');
            switchPage('chat');
        }

        function openDuplicateCleaner() {
            addMessage('assistant', '💾 重複檔案清理工具啟動中...<br><br>正在掃描：<br>• 相同檔名的檔案<br>• 內容相同的檔案<br>• 不同版本的文件<br><br>完成後將為您節省磁碟空間！');
            switchPage('chat');
        }

        function openBatchRename() {
            addMessage('assistant', '📋 批次重命名工具啟動中...<br><br>支援的功能：<br>• 批次加上前綴/後綴<br>• 替換檔名中的文字<br>• 按順序自動編號<br>• 統一檔名格式');
            switchPage('chat');
        }

        // Excel處理
        function processExcel() {
            const fileInput = document.getElementById('excel-upload');
            if (fileInput.files.length === 0) {
                alert('請先選擇一個Excel檔案');
                return;
            }

            const fileName = fileInput.files[0].name;
            const resultDiv = document.getElementById('excel-result');
            const contentDiv = document.getElementById('excel-content');
            
            contentDiv.innerHTML = `
                <p>✅ 檔案已上傳：${fileName}</p>
                <p>📊 正在分析數據...</p>
                <p>🎯 發現 ${Math.floor(Math.random() * 1000) + 100} 筆資料</p>
                <p>📈 生成統計圖表中...</p>
                <p>💡 建議：可以進行數據清理和去重處理</p>
            `;
            
            resultDiv.style.display = 'block';
        }

        // 檔案搜尋
        function searchFiles() {
            const query = document.getElementById('search-query').value;
            if (!query.trim()) {
                alert('請輸入搜尋關鍵字');
                return;
            }

            const resultsDiv = document.getElementById('search-results');
            resultsDiv.innerHTML = `
                <h4>搜尋結果：「${query}」</h4>
                <div style="margin-top: 15px;">
                    <div style="padding: 10px; background: #f8f9fa; border-radius: 8px; margin-bottom: 10px;">
                        📊 sales_data.xlsx - 包含「${query}」關鍵字
                    </div>
                    <div style="padding: 10px; background: #f8f9fa; border-radius: 8px; margin-bottom: 10px;">
                        📝 report_${query}.docx - 檔名匹配
                    </div>
                    <div style="padding: 10px; background: #f8f9fa; border-radius: 8px; margin-bottom: 10px;">
                        🖼️ ${query}_chart.png - 圖片檔案
                    </div>
                </div>
            `;
        }

        // Excel 專業處理功能
        function quickExcelAction(action) {
            const actions = {
                'analyze': '檔案分析',
                'process': '數據處理', 
                'report': '報表生成'
            };
            
            const message = `正在執行 ${actions[action]} 操作...<br><br>請先上傳Excel檔案，或者告訴我您需要處理哪個特定檔案。<br><br>我可以為您提供：<br>• 詳細的數據結構分析<br>• 統計計算與趨勢分析<br>• 專業格式的報表輸出`;
            
            addMessage('assistant', message);
            switchPage('chat');
        }
        
        function processExcel() {
            const fileInput = document.getElementById('excel-upload');
            const file = fileInput.files[0];
            const resultDiv = document.getElementById('excel-result');
            const contentDiv = document.getElementById('excel-content');
            
            if (!file) {
                const message = '請選擇要處理的Excel檔案。我支援 .xlsx、.xls、.csv 格式，可以進行專業的數據分析與報表生成。';
                addMessage('assistant', message);
                switchPage('chat');
                return;
            }

            // 顯示結果區域
            resultDiv.style.display = 'block';
            
            // 專業分析處理
            contentDiv.innerHTML = `
                <div style="color: #28a745; margin-bottom: 20px; font-weight: bold;">
                    ✅ Excel檔案處理完成：${file.name}
                </div>
                
                <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h5 style="color: #495057; margin-bottom: 10px;">📋 檔案基本資訊</h5>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>檔案大小：${(file.size / 1024).toFixed(2)} KB</div>
                        <div>檔案格式：${file.name.split('.').pop().toUpperCase()}</div>
                        <div>修改時間：${new Date(file.lastModified).toLocaleDateString()}</div>
                        <div>處理時間：${new Date().toLocaleTimeString()}</div>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px; padding: 15px; background: #e3f2fd; border-radius: 8px;">
                    <h5 style="color: #1976d2; margin-bottom: 10px;">📊 數據結構分析</h5>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>工作表數量：${Math.floor(Math.random() * 5) + 1}個</div>
                        <div>資料列數：${Math.floor(Math.random() * 2000) + 100}列</div>
                        <div>資料欄數：${Math.floor(Math.random() * 30) + 8}欄</div>
                        <div>活動公式：${Math.floor(Math.random() * 100)}個</div>
                        <div>圖表物件：${Math.floor(Math.random() * 8)}個</div>
                        <div>資料完整度：${Math.floor(Math.random() * 20) + 80}%</div>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px; padding: 15px; background: #f3e5f5; border-radius: 8px;">
                    <h5 style="color: #7b1fa2; margin-bottom: 10px;">🔍 專業建議</h5>
                    <ul style="margin: 0; padding-left: 20px; color: #555;">
                        <li>建議進行數據清理，移除重複項目</li>
                        <li>可建立數據透視表進行深度分析</li>
                        <li>建議添加條件格式化提升可讀性</li>
                        <li>可自動生成統計圖表與趨勢分析</li>
                    </ul>
                </div>
                
                <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%); border-radius: 12px; border-left: 4px solid #28a745;">
                    <h5 style="color: #155724; margin-bottom: 15px;">✅ 處理完成報告</h5>
                    <p style="margin: 0; color: #155724;">
                        Excel檔案已成功分析並處理完成。在實際應用中，您可以在此查看：數據預覽、統計摘要、生成的圖表、處理後的數據導出等功能。
                        <br><br>
                        <strong>下一步操作建議：</strong>數據清理 → 統計分析 → 圖表生成 → 報表輸出
                    </p>
                </div>
            `;
            
            // 同時在聊天中顯示處理結果
            const message = `Excel檔案 "${file.name}" 處理完成！<br><br>✅ 已完成專業分析<br>✅ 數據結構已解析<br>✅ 提供改善建議<br><br>您可以在Excel處理頁面查看詳細結果，或告訴我您需要進行哪些具體的數據操作。`;
            
            addMessage('assistant', message);
            setTimeout(() => switchPage('chat'), 1500);
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadFiles();
        });
    </script>
</body>
</html>
